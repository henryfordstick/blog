# 第五章 正则表达式的拆分
对于正则，不仅自己能解决问题，还要看懂别人的解决方案，所以如何能把一大串正则拆分成一块一块的，成为了破解”天书“的关键。
- 一、结构和操作符
- 二、注意要点
- 三、案例分析

## 一、结构和操作符
编程语言一般都有操作符，有操作符就要有优先级，那么正则的优先级是怎么样的？
#### 1、正则中的结构
字符字面量，字符组，量词， 锚，分组，选择分支，反向引用

| 结构 | 说明 |
|---|---|
| 字面量 | 匹配一个具体字符，包括不用转义的和需要转义的。比如 `a` 匹配字符 "a"， 又比如 `\n` 匹配换行符，又比如 `\.` 匹配小数点。 |
| 字符组 | 匹配一个字符，可以是多种可能之一，比如 `[0-9]`，表示匹配一个数字。<br/>也有 `\d` 的简写形式。<br/>另外还有反义字符组，表示可以是除了特定字符之外任何一个字符，比如 `[^0-9]`， 表示一个非数字字符，也有 `\D` 的简写形式。 |
| 量词 | 表示一个字符连续出现，比如 `a{1,3}` 表示 "a" 字符连续出现 `3` 次。<br/>另外还有常见的简写形式，比如 `a+` 表示 "a" 字符连续出现至少一次。|
| 锚 | 匹配一个位置，而不是字符。比如 `^` 匹配字符串的开头，又比如 `\b` 匹配单词边界， 又比如 `(?=\d)` 表示数字前面的位置。 |
| 分组 | 用括号表示一个整体，比如 `(ab)+`，表示 "ab" 两个字符连续出现多次，也可以使用非捕获分组 `(?:ab)+`。 |
| 分支 | 多个子表达式多选一，比如 `abc|bcd`，表达式匹配 "abc" 或者 "bcd" 字符子串。 |
| 反向<br/>引用 | 比如 `\2`，表示引用第 `2` 个分组。|

#### 2、正则中的操作符
转义符，括号和方括号，量词限定符，位置和序列，管道符

| 操作符描述 | 操作符 | 优先级 |
|---|---|---|
| 转义符 | `\` | 1 |
| 括号和方括号 | `(...)`,`(?:...)`,`(?=...)`,`(?!...)`,`[...]` | 2 |
| 量词限定符 | `{m}`,`{m,n}`,`?`,`*`,`+` | 3 |
| 位置和序列 | `^`,`$`,`\元字符`，`一般字符` | 4 |
| 管道符（竖杠） | `|` | 5 |

上面操作符的优先级从上至下，由高到低。
#### 3、分析正则
`/ab?(c|de*)+|fg/`
1. 由于有括号，所以`(c|de*)` 是一个整体
2. `(c|de*)` 中有量词，管道符，所以 `c` 是一个整体，`de*`是一个整体
3. 所以最终上面的正则可以分为 `a`、 `b?`、`(...)+`、`f`、`g`
4. 也可以分为 `ab?(c|de*)+` 和 `fg` 两部分

## 二、注意要点
#### 1、匹配字符串整体问题
我们经常会在正则前后加上 `^` 和 `$`,比如匹配目标字符串 abc 或 bcd，不小心会写成 `/^abc|bcd$/`

而 位置字符 和 字符序列 优先级比竖杠高，就会导致正则错误。正确写法应该为 `/^(abc|bcd)$/`

#### 2、量词连缀问题
假如需要匹配这样的字符串：
1. 每个字符串为 a、b、c 任选其一
2. 字符串的长度是3的倍数

那么就会不小心写成 `/^[abc]{3}+$/`

这样就会报错，说 `+` 前面没有什么可重复的，正确的要改成 `/^([abc]{3})+$/`

#### 3、元字符转义问题
所谓**元字符**，就是正则中有特殊含义的字符。即

`^`、`$`、`.`、`*`、`+`、`?`、`|`、`\`、`/`、`(`、`)`、`[`、`]`、`{`、`}`、`=`、`!`、`:`、`-`、`,` 当匹配本身的时候可以一律用 `\` 转义，字符串中的`\` 也要转义成 `\\`。

在**字符组中有些就不需要转义**，除了 `[`、`]`、`^`、`-` 必须转义

匹配字符串 "[abc]" 和 "{3,5}" 时，"[abc]"写成 `/\[abc\]/`。也可以写成 `/\[abc]/`，后面的方括号不构成字符组，不会引发歧义。同理 "{3,5}" 可以写成 `/\{3,5}/`。量词的简写形式有 `{m,}`，却没有`{,n}`的情况，所有匹配字符串 "{,n}" 的时候写成 `/{,3}/g` 也可以。

总结下来：<br/>
- 如`=`、`!`、`:`、`-`、`,` 等符号，只要不在特殊结构中，并不需要转义
- 括号是需要前后都转义的，如 `/\(123\)/`
- `^`、`$`、`.`、`*`、`+`、`?`、`|`、`\`、`/`等字符，只要不在字符组内，都需要转义的

如果不确定与否，尽管去转义，总之是不会错。



