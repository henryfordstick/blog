<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React Native æ¡¥æ¥ä¹‹è·¯ | æ¸”ç½‘çš„æ”¶è·</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/user.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.f85f523a.css" as="style"><link rel="preload" href="/assets/js/app.596f9c08.js" as="script"><link rel="preload" href="/assets/js/2.55845630.js" as="script"><link rel="preload" href="/assets/js/32.3cfb5af5.js" as="script"><link rel="preload" href="/assets/js/3.e0f79c9f.js" as="script"><link rel="prefetch" href="/assets/js/10.81c55362.js"><link rel="prefetch" href="/assets/js/11.a8961898.js"><link rel="prefetch" href="/assets/js/12.27d273d8.js"><link rel="prefetch" href="/assets/js/13.17b526ee.js"><link rel="prefetch" href="/assets/js/14.9fb9f1f6.js"><link rel="prefetch" href="/assets/js/15.68809f88.js"><link rel="prefetch" href="/assets/js/16.aba76e28.js"><link rel="prefetch" href="/assets/js/17.935024df.js"><link rel="prefetch" href="/assets/js/18.87e02b1b.js"><link rel="prefetch" href="/assets/js/19.9ce88a57.js"><link rel="prefetch" href="/assets/js/20.153bc889.js"><link rel="prefetch" href="/assets/js/21.c6d8215f.js"><link rel="prefetch" href="/assets/js/22.1e61390a.js"><link rel="prefetch" href="/assets/js/23.7ec11354.js"><link rel="prefetch" href="/assets/js/24.9cb6f350.js"><link rel="prefetch" href="/assets/js/25.26af678e.js"><link rel="prefetch" href="/assets/js/26.257a042b.js"><link rel="prefetch" href="/assets/js/27.7b4ab38d.js"><link rel="prefetch" href="/assets/js/28.e64b7c0b.js"><link rel="prefetch" href="/assets/js/29.0979406b.js"><link rel="prefetch" href="/assets/js/30.fe5a4276.js"><link rel="prefetch" href="/assets/js/31.797bcde4.js"><link rel="prefetch" href="/assets/js/33.621a195e.js"><link rel="prefetch" href="/assets/js/34.a17ff68f.js"><link rel="prefetch" href="/assets/js/35.98958db5.js"><link rel="prefetch" href="/assets/js/36.9d8c8f04.js"><link rel="prefetch" href="/assets/js/37.14e93bdb.js"><link rel="prefetch" href="/assets/js/38.13542f75.js"><link rel="prefetch" href="/assets/js/4.7c53c391.js"><link rel="prefetch" href="/assets/js/5.d6b23f0c.js"><link rel="prefetch" href="/assets/js/6.da3f1227.js"><link rel="prefetch" href="/assets/js/7.2b2bf1e6.js"><link rel="prefetch" href="/assets/js/8.a9d9e867.js"><link rel="prefetch" href="/assets/js/9.79800cc0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f85f523a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">æ¸”ç½‘çš„æ”¶è·</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><a href="/arith/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  é˜…è¯»
</a></div> <a href="https://github.com/henryfordstick" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><a href="/arith/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  é˜…è¯»
</a></div> <a href="https://github.com/henryfordstick" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>è§†é‡æ‹“å±•</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/expand-browser.html" class="sidebar-link">æµè§ˆå™¨åŸç†æµ…æ</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/react-library.html" class="sidebar-link">React ä½¿ç”¨æ€»ç»“</a></li><li><a href="/blog/react-library-core.html" class="sidebar-link">React æ ¸å¿ƒçŸ¥è¯†</a></li><li><a href="/blog/react-source-one.html" class="sidebar-link">React æºç åˆ†æï¼ˆä¸€ï¼‰JSX è½¬æ¢</a></li><li><a href="/blog/react-native.html" class="sidebar-link">React Native ä½¿ç”¨æ€»ç»“</a></li><li><a href="/blog/react-native-bridge.html" aria-current="page" class="active sidebar-link">React Native æ¡¥æ¥ä¹‹è·¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/react-native-bridge.html#è¯´è¯´-rn-çš„æ•…äº‹" class="sidebar-link">è¯´è¯´ RN çš„æ•…äº‹</a></li><li class="sidebar-sub-header"><a href="/blog/react-native-bridge.html#rn-ä¸ºä»€ä¹ˆèƒ½ç¼–å†™åŸç”Ÿåº”ç”¨" class="sidebar-link">RN ä¸ºä»€ä¹ˆèƒ½ç¼–å†™åŸç”Ÿåº”ç”¨</a></li><li class="sidebar-sub-header"><a href="/blog/react-native-bridge.html#rn-æ˜¯å¦‚ä½•æ„é€ åº”ç”¨å¸ƒå±€çš„" class="sidebar-link">RN æ˜¯å¦‚ä½•æ„é€ åº”ç”¨å¸ƒå±€çš„</a></li><li class="sidebar-sub-header"><a href="/blog/react-native-bridge.html#æ ¹æ®é¡¹ç›®å” æ¡¥æ¥" class="sidebar-link">æ ¹æ®é¡¹ç›®å” æ¡¥æ¥</a></li><li class="sidebar-sub-header"><a href="/blog/react-native-bridge.html#ç›¸å…³é“¾æ¥" class="sidebar-link">ç›¸å…³é“¾æ¥</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML/CSS</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScriptåŸºç¡€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js-undefined-null.html" class="sidebar-link">null å’Œ undefined åŒºåˆ«</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç½‘ç»œåŸºç¡€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/internet-movement.html" class="sidebar-link">äº’è”ç½‘æ˜¯å¦‚ä½•è¿ä½œçš„</a></li><li><a href="/blog/internet-osi.html" class="sidebar-link">ç†è§£ OSI æ¨¡å‹å’Œ TCP/IP æ¨¡å‹</a></li><li><a href="/blog/internet-http.html" class="sidebar-link">HTTP åè®®æ€»ç»“</a></li><li><a href="/blog/internet-https.html" class="sidebar-link">HTTPS åè®®æ€»ç»“</a></li><li><a href="/blog/internet-tcp.html" class="sidebar-link">TCP åè®®æ€»ç»“</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç¼–ç¨‹åŸºç¡€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/basis-ts1.html" class="sidebar-link">æ·±å…¥ TypeScript ç³»åˆ—ï¼ˆä¸€ï¼‰</a></li><li><a href="/blog/basis-ts2.html" class="sidebar-link">æ·±å…¥ Typescript ç³»åˆ—ï¼ˆäºŒï¼‰</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-native-æ¡¥æ¥ä¹‹è·¯"><a href="#react-native-æ¡¥æ¥ä¹‹è·¯" class="header-anchor">#</a> React Native æ¡¥æ¥ä¹‹è·¯</h1> <p>React Native æ˜¯ Facebook å¼€æºçš„è·¨å¹³å°æ¡†æ¶ï¼Œä¸ºäº†è®²è§£æ–¹ä¾¿ï¼Œæˆ‘å°† React Native ç®€ç§°ä¸º RNã€‚RN å®˜ç½‘è¯´èƒ½ç”¨ JavaScript ç¼–å†™åŸç”Ÿç§»åŠ¨åº”ç”¨ï¼Œè€Œä¸”ç”¨ JS è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥å‘¼å«åŸç”ŸåŒå­¦ã€‚
é‚£ä¹ˆè¿™é‡Œå°±ç‰µæ‰¯åˆ°äº† RN ä¸ Native çš„é€šä¿¡é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»ä¸‹é¢å‡ ä¸ªè¯é¢˜ç”±æµ…å…¥æ·±æ¢è®¨ä¸€ä¸‹ï¼ï¼ï¼</p> <ul><li>è¯´è¯´ RN çš„æ•…äº‹</li> <li>RN ä¸ºä»€ä¹ˆèƒ½ç¼–å†™åŸç”Ÿåº”ç”¨</li> <li>RN æ˜¯å¦‚ä½•æ„é€ åº”ç”¨å¸ƒå±€çš„</li> <li>æ ¹æ®é¡¹ç›®å” æ¡¥æ¥</li> <li>ç›¸å…³é“¾æ¥</li></ul> <h2 id="è¯´è¯´-rn-çš„æ•…äº‹"><a href="#è¯´è¯´-rn-çš„æ•…äº‹" class="header-anchor">#</a> è¯´è¯´ RN çš„æ•…äº‹</h2> <p>Facebook æ›¾è‡´åŠ›äºä½¿ç”¨ HTML5 è¿›è¡Œç§»åŠ¨ç«¯çš„å¼€å‘ ï¼Œç»“æœå‘ç°åœ¨æ€§èƒ½æ–¹é¢ä¸åŸç”Ÿçš„ App ç›¸å·®è·è¶Šæ¥è¶Šå¤§ã€‚æœ€ç»ˆï¼ŒFacebook æ”¾å¼ƒäº† RN æŠ€æœ¯è·¯çº¿ï¼Œäº 2015 å¹´ 3 æœˆæ­£å¼å‘å¸ƒäº† RN æ¡†æ¶ï¼Œæ­¤æ¡†æ¶ä¸“æ³¨äºç§»åŠ¨ç«¯ App çš„å¼€å‘ã€‚</p> <p>åœ¨æœ€åˆå‘å¸ƒçš„ç‰ˆæœ¬ä¸­ï¼Œ RN æ¡†æ¶åªç”¨äºå¼€å‘ iOS å¹³å°çš„ App, 2015 å¹´ 9 æœˆï¼Œ Facebook å‘å¸ƒäº†æ”¯æŒ Android å¹³å°çš„ RN æ¡†æ¶ è‡³æ­¤ï¼Œ RN æ¡†æ¶çœŸæ­£å®ç°äº†è·¨å¹³å°çš„ç§»åŠ¨ App å¼€å‘ï¼Œæ­¤ä¸¾ç®€ç›´å°±æ˜¯ç§»åŠ¨ App å¼€å‘äººå‘˜çš„ç¦éŸ³ã€‚</p> <h2 id="rn-ä¸ºä»€ä¹ˆèƒ½ç¼–å†™åŸç”Ÿåº”ç”¨"><a href="#rn-ä¸ºä»€ä¹ˆèƒ½ç¼–å†™åŸç”Ÿåº”ç”¨" class="header-anchor">#</a> RN ä¸ºä»€ä¹ˆèƒ½ç¼–å†™åŸç”Ÿåº”ç”¨</h2> <p>åœ¨è®²è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ RN çš„æ¶æ„å›¾ã€‚
<img src="/images/react-native-con.jpeg" alt="React Native æ¶æ„"></p> <ul><li>ç»¿è‰²éƒ¨åˆ†æ˜¯åº”ç”¨å¼€å‘çš„éƒ¨åˆ†ï¼Œä¸šåŠ¡é€»è¾‘ä»£ç å°±åœ¨è¿™é‡Œã€‚</li> <li>è“è‰²éƒ¨åˆ†æ˜¯è·¨å¹³å°çš„ä»£ç å’Œå¼•æ“ï¼Œä¸€èˆ¬ä¸ä¼šæ”¹å†™è“è‰²éƒ¨åˆ†ã€‚</li> <li>é»„è‰²ä»£ç å¹³å°ç›¸å…³çš„ä»£ç ï¼Œåšå®šåˆ¶åŒ–çš„æ—¶å€™ä¼šæ·»åŠ ä¿®æ”¹ä»£ç ã€‚æ˜¯å„ä¸ªå¹³å°ç”¨æ¥åšæ¡¥æ¥(Bridge)çš„ã€‚</li> <li>çº¢è‰²éƒ¨åˆ†æ˜¯ç³»ç»Ÿå¹³å°çš„ä¸œè¥¿ã€‚çº¢è‰²ä¸Šé¢æœ‰ä¸€ä¸ªè™šçº¿ï¼Œè¡¨ç¤ºæ‰€æœ‰å¹³å°ç›¸å…³çš„ä¸œè¥¿éƒ½é€šè¿‡ Bridge éš”ç¦»å¼€æ¥äº†ã€‚</li></ul> <p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¼€å‘æ‰€å†™çš„ JS ä»£ç éƒ½åœ¨ç»¿è‰²éƒ¨åˆ†ï¼Œé»„è‰²éƒ¨åˆ†æ˜¯ç”¨ åŸä»£ç å†™çš„æ¡¥æ¥ç»„ä»¶ï¼Œå…¶ä»–éƒ¨åˆ†ä¸ç”¨æ¶‰åŠã€‚</p> <p>æˆ–è®¸è¿™æ ·çš„è§£é‡Šæœ‰ç‚¹ç¬¼ç»Ÿï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¸‹é¢è¯¦ç»†è®²è§£ä¸€ä¸‹ RN çš„æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ã€‚</p> <h3 id="rn-çš„æ¶æ„"><a href="#rn-çš„æ¶æ„" class="header-anchor">#</a> RN çš„æ¶æ„</h3> <p>é‚£ä¹ˆæˆ‘ä»¬æŠŠå‰é¢æ¶æ„å›¾çš„çš„è™šçº¿ä¸Šé¢éƒ¨åˆ†å†ç”»è¯¦ç»†ç‚¹ï¼Œå°±å¾—åˆ°äº†ä¸‹é¢è¿™å¼ å›¾ğŸ˜ï¼</p> <p><img src="/images/rn-bridge.jpg" alt="RN åŸç†"></p> <p>æˆ‘ä»¬å¯ä»¥æŠŠ RN çš„æ•´ä¸ªæ¶æ„åˆ†ä¸ºä¸‰å±‚ï¼š</p> <ul><li><p>ç¬¬ä¸€å±‚æ˜¯ç”¨ React å†™çš„ JS ä»£ç å±‚ï¼ˆä¹Ÿå°±æ˜¯æ¶æ„å›¾ä¸­<strong>ç»¿è‰²éƒ¨åˆ†</strong>ï¼‰ï¼Œè¿™é‡Œçš„ä»£ç è·‘åœ¨ JS å¼•æ“<code>JavaScriptCore</code>ä¸Šã€‚åœ¨ Debug æ¨¡å¼ä¸‹è·‘åœ¨ Chrome æµè§ˆå™¨çš„ V8 å¼•æ“ä¸Šï¼Œé€šè¿‡<code>Websocket</code>å‘é€åˆ°ç§»åŠ¨è®¾å¤‡ã€‚</p></li> <li><p>ç¬¬äºŒå±‚æ˜¯æ¡¥æ¥ JS å’Œ Nativeã€‚åœ¨ 0.59 æ‰€æœ‰çš„é€šä¿¡éƒ½éœ€è¦ç»è¿‡ JSON åºåˆ—åŒ–ä»¥åé€šè¿‡ Bridge å¼‚æ­¥é€šä¿¡ã€‚0.59 å¼€å§‹ç”¨äº†æ–°æ¶æ„ Fabric å®ç°çš„ JSI å®ç°äº† js å’Œ native çš„ç›´æ¥å…±äº«å†…å­˜è°ƒç”¨ï¼Œè€Œæ— éœ€å†ç»è¿‡ Bridgeã€‚</p></li> <li><p>ç¬¬ä¸‰å±‚æ˜¯ Native å±‚ï¼Œä¸»è¦æ¸²æŸ“åŸç”Ÿç»„ä»¶å’Œä¼ é€’äº‹ä»¶ã€‚React å†™çš„ <strong>Virtual DOM èŠ‚ç‚¹æ˜¯åˆ©ç”¨<code>yoga</code>è§£æ</strong>ï¼Œæ˜ å°„ä¸ºåŸç”Ÿç»„ä»¶ï¼Œæ‰€ä»¥èƒ½å®ç°ä¸€å¥—ä»£ç åœ¨ Android å’Œ iOS åŸç”Ÿç«¯ä½¿ç”¨ã€‚</p></li></ul> <p>React è‡ªèº«æ˜¯ä¸ç›´æ¥ç»˜åˆ¶ UI çš„ï¼ŒUI ç»˜åˆ¶æ˜¯éå¸¸è€—æ—¶çš„æ“ä½œï¼ŒåŸç”Ÿç»„ä»¶æœ€æ“…é•¿è¿™äº‹æƒ…ã€‚</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼ŒReact Native å’Œ NodeJS æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚å®ƒä»¬éƒ½æ˜¯é€šè¿‡æ‰©å±• JavaScript Engine, ä½¿å®ƒå…·å¤‡å¼ºå¤§çš„æœ¬åœ°èµ„æºå’ŒåŸç”Ÿæ¥å£è°ƒç”¨èƒ½åŠ›ï¼Œç„¶åç»“åˆ JavaScript ä¸°å¯Œçš„åº“å’Œç¤¾åŒºå’ŒåŠå…¶ç¨³å®šçš„è·¨å¹³å°èƒ½åŠ›ï¼Œ æŠŠ Javascript çš„é­”åŠ›åœ¨æµè§ˆå™¨ä¹‹å¤–çš„åœ°æ–¹å……åˆ†å‘æŒ¥å‡ºæ¥ã€‚</p></div> <h3 id="yoga-å¼•æ“"><a href="#yoga-å¼•æ“" class="header-anchor">#</a> Yoga å¼•æ“</h3> <p><strong>Yoga æ˜¯ä¸€ä¸ªåŸºäº <em>Flexbox</em> çš„è·¨å¹³å°å¸ƒå±€å¼•æ“</strong>ï¼Œæœ€åˆæ˜¯ Facebook åœ¨ 2014 å¹´æ¨å‡ºçš„ä¸€ä¸ª CSS å¸ƒå±€çš„å¼€æºåº“ï¼Œ2016 å¹´æ”¹ç‰ˆå¹¶æ›´åä¸º Yogaã€‚</p> <p><strong>Flexbox</strong>(CSS Flexible Box) æ˜¯ç”¨æ¥å¤„ç† web ä¸Šçš„å¤æ‚å¸ƒå±€ã€‚Yoga å¹¶æ²¡æœ‰å®ç°å…¨éƒ¨ CSS Flexboxã€‚
å®ƒçœç•¥äº†éå¸ƒå±€å±æ€§ï¼Œå¦‚è®¾ç½®é¢œè‰²ã€‚Yoga æ”¹è¿›äº†ä¸€äº› Flexbox çš„å±æ€§æ¥æä¾›æ›´å¥½çš„ä»å³åˆ°å·¦çš„æ”¯æŒã€‚æœ€åï¼ŒYoga å¢åŠ äº†ä¸€ä¸ªæ–°çš„æ¯”ä¾‹ï¼ˆAspectRatioï¼‰å±æ€§æ¥å¤„ç†åœ¨å¸ƒç½®æŸäº›å…ƒç´ å¦‚å›¾ç‰‡æ—¶å¸¸è§çš„éœ€æ±‚ã€‚</p> <h2 id="rn-æ˜¯å¦‚ä½•æ„é€ åº”ç”¨å¸ƒå±€çš„"><a href="#rn-æ˜¯å¦‚ä½•æ„é€ åº”ç”¨å¸ƒå±€çš„" class="header-anchor">#</a> RN æ˜¯å¦‚ä½•æ„é€ åº”ç”¨å¸ƒå±€çš„</h2> <p>åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆè¯´è¯´ RN çš„å·¥ä½œæ–¹å¼ã€‚</p> <h3 id="çº¿ç¨‹æ¨¡å‹"><a href="#çº¿ç¨‹æ¨¡å‹" class="header-anchor">#</a> çº¿ç¨‹æ¨¡å‹</h3> <p><img src="/images/rn-old-ui.jpeg" alt="RN å·¥ä½œæ–¹å¼">
RN ä¸­æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p> <ul><li>MAIN Thread/UI Thread: ä¹Ÿå« UI çº¿ç¨‹ï¼Œè¿è¡Œ Android / iOS åº”ç”¨ç¨‹åºçš„ä¸»è¦åº”ç”¨ç¨‹åºçš„çº¿ç¨‹ï¼Œå®ƒå…·æœ‰è®¿é—® UI çš„æƒé™ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡æ­¤çº¿ç¨‹æ›´æ”¹ UIã€‚</li> <li>Shadow Thread: æ˜¯ RN ä½¿ç”¨ React åº“è¿›è¡Œå¸ƒå±€è®¡ç®—å’Œæ„é€  UI ç•Œé¢çš„çº¿ç¨‹ã€‚</li> <li>JS Thread: React ç­‰ JavaScript ä»£ç éƒ½åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li></ul> <p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç±» Native Modules çº¿ç¨‹ï¼Œä¸åŒçš„ Native Modules å¯ä»¥è¿è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ã€‚</p> <h3 id="å¯åŠ¨è¿‡ç¨‹"><a href="#å¯åŠ¨è¿‡ç¨‹" class="header-anchor">#</a> å¯åŠ¨è¿‡ç¨‹</h3> <p>çŸ¥é“äº† RN çš„çº¿ç¨‹å…³ç³»ä¹‹åï¼Œæ¥ä¸‹æ¥çœ‹ RN æ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‚</p> <p>é¦–å…ˆå‘¢ï¼ŒApp å¯åŠ¨æ—¶åˆå§‹åŒ– React Native è¿è¡Œæ—¶ç¯å¢ƒï¼ˆå³ Bridgeï¼‰ï¼ŒBridge å‡†å¤‡å¥½ä»¥åå¼€å§‹ Native æ¸²æŸ“ã€‚</p> <p>é‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ– Bridge è¿‡ç¨‹åˆ†ä¸º 4 éƒ¨åˆ†ï¼š</p> <ul><li>åŠ è½½ JavaScript ä»£ç ï¼šå¼€å‘æ¨¡å¼ä¸‹ä»ç½‘ç»œä¸‹è½½ï¼Œç”Ÿäº§ç¯å¢ƒä»è®¾å¤‡å­˜å‚¨ä¸­è¯»å–ã€‚</li> <li>åˆå§‹åŒ– Native Moduleï¼šæ ¹æ® Native Module æ³¨å†Œä¿¡æ¯ï¼ŒåŠ è½½å¹¶å®ä¾‹åŒ–æ‰€æœ‰ Native Moduleã€‚</li> <li>æ³¨å…¥ Native Module ä¿¡æ¯ï¼šå– Native Module æ³¨å†Œä¿¡æ¯ï¼Œä½œä¸ºå…¨å±€å˜é‡æ³¨å…¥åˆ° JS Context ä¸­ã€‚</li> <li>åˆå§‹åŒ– JavaScript å¼•æ“ï¼š å³ JavaScriptCoreã€‚</li></ul> <p>Bridge å»ºç«‹ä¹‹åï¼ŒJavaScript ä»£ç å¼€å§‹æ‰§è¡Œï¼Œæ¸²æŸ“ç”¨æˆ·ç•Œé¢å¹¶å®ç°ä¸šåŠ¡åŠŸèƒ½ã€‚</p> <p><img src="/images/rn-new-ui.jpeg" alt="RN å·¥ä½œæ–¹å¼ 2"></p> <p>æ¸²æŸ“ç•Œé¢çš„è¿‡ç¨‹ï¼š</p> <ul><li>JS çº¿ç¨‹å°†è§†å›¾ä¿¡æ¯(ç»“æ„ã€æ ·å¼ã€å±æ€§ç­‰) ä¼ é€’ç»™ Shadow çº¿ç¨‹ã€‚</li> <li>åˆ›å»ºå‡ºç”¨äºå¸ƒå±€è®¡ç®—çš„ Shadow Treeã€‚</li> <li>Shadow çº¿ç¨‹è®¡ç®—å¥½å¸ƒå±€ä¹‹åï¼Œå†å°†å®Œæ•´çš„è§†å›¾ä¿¡æ¯ï¼ˆåŒ…æ‹¬å®½é«˜ã€ä½ç½®ç­‰ï¼‰ä¼ é€’ç»™ UI çº¿ç¨‹ï¼ŒUI çº¿ç¨‹æ®æ­¤åˆ›å»º Native Viewã€‚</li></ul> <p>ç”¨æˆ·åŠ¨ä½œåé¦ˆçš„è¿‡ç¨‹ï¼š</p> <ul><li>å¯¹äºç”¨æˆ·è¾“å…¥ï¼Œåˆ™å…ˆç”± UI çº¿ç¨‹å°†ç›¸å…³ä¿¡æ¯æ‰“åŒ…æˆäº‹ä»¶æ¶ˆæ¯ä¼ é€’åˆ° Shadow çº¿ç¨‹ã€‚</li> <li>Shadow çº¿ç¨‹å†æ ¹æ® Shadow Tree å»ºç«‹çš„æ˜ å°„å…³ç³»ç”Ÿæˆç›¸åº”å…ƒç´ çš„æŒ‡å®šäº‹ä»¶ã€‚</li> <li>æœ€åå°†äº‹ä»¶ä¼ é€’åˆ° JS çº¿ç¨‹ï¼Œæ‰§è¡Œå¯¹åº”çš„ JS å›è°ƒå‡½æ•°ã€‚</li></ul> <h2 id="æ ¹æ®é¡¹ç›®å” æ¡¥æ¥"><a href="#æ ¹æ®é¡¹ç›®å” æ¡¥æ¥" class="header-anchor">#</a> æ ¹æ®é¡¹ç›®å” æ¡¥æ¥</h2> <p>æˆ‘å‰é¢è®²äº† RN çš„åŸºæœ¬åŸç†ï¼Œæ˜ç™½ä»–æ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‚é‚£ä¹ˆæ—¥å¸¸ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ RN å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œï¼Œä½†æ˜¯å¦‚æœæƒ³ç”¨ä¸€äº›ç°æˆåŸç”Ÿä»£ç ï¼Œæˆ–è€…è®©åŸç”Ÿæ¥å¤„ç†ä¸€äº›é«˜æ€§èƒ½çš„å¤šçº¿ç¨‹ä»£ç æ—¶æ€ä¹ˆåŠï¼Ÿ</p> <p>è¦å®ç°åŸç”Ÿä¸ JS é€šä¿¡ï¼Œå°±è¦ä½¿ç”¨ RN çš„ Bridge æ¥å®ç°ï¼Œè¿™é‡Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±å°è£… Bridge ã€‚åŒ…æ‹¬å’±ä»¬è‡ªå·±é¡¹ç›®ä¸­ç”¨åˆ°ç»§æ‰¿ FIDOï¼Œå®‰å…¨é”®ç›˜ï¼ŒBugly ç­‰ç­‰çš„ SDK éƒ½éœ€è¦ç”¨åˆ°æ¡¥æ¥ã€‚</p> <p>æ¥ä¸‹æ¥æˆ‘å°±ä»ä»£ç å±‚é¢è®²è®² Bridgeï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬æˆ‘åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„å‘ç‚¹ã€‚</p> <h3 id="fido-æ¨¡å—"><a href="#fido-æ¨¡å—" class="header-anchor">#</a> FIDO æ¨¡å—</h3> <p>FIDO æ¨¡å—è°ƒç”¨äº†ç¬¬ä¸‰æ–¹çš„ SDKï¼Œç„¶åç”±åŸç”Ÿå®ç°éƒ¨åˆ† UI çš„äº¤äº’éƒ¨åˆ†ã€‚è¿™é‡Œåªéœ€è¦ JS è°ƒç”¨åŸç”Ÿæä¾›çš„æ–¹æ³•ä»¥åŠ JS ç›‘å¬åŸç”Ÿæ–¹æ³•æä¾›çš„å›è°ƒã€‚</p> <h4 id="ä¸€ã€æ·»åŠ -fidomodules"><a href="#ä¸€ã€æ·»åŠ -fidomodules" class="header-anchor">#</a> ä¸€ã€æ·»åŠ  FIDOModules</h4> <p>FIDOModules æ˜¯æ¡¥æ¥æ ¸å¿ƒçš„ä»£ç æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­ mobile æ˜¯å·¥ç¨‹åç§°ï¼Œè¿™é‡Œéšæ„æ·»åŠ çš„ã€‚
<strong>Android ä»£ç </strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * android/app/src/main/java/com/mobile/FIDO/FIDOModules.java
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mobile<span class="token punctuation">.</span></span>FIDO<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">Arguments</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">Promise</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactApplicationContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactContextBaseJavaModule</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactMethod</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReadableMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">UiThreadUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">WritableMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">DeviceEventManagerModule</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FIDOModules</span> <span class="token keyword">extends</span> <span class="token class-name">ReactContextBaseJavaModule</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SET_NAME <span class="token operator">=</span> <span class="token string">&quot;FIDOModules&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReactApplicationContext</span> reactContext<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">FIDOManager</span><span class="token punctuation">(</span><span class="token class-name">ReactApplicationContext</span> reactContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>reactContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reactContext <span class="token operator">=</span> reactContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¿™ä¸ªå‡½æ•°ç”¨äºè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åå­—ï¼Œè¿™ä¸ªåå­—åœ¨ JavaScript ç«¯æ ‡è®°è¿™ä¸ªæ¨¡å—</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> SET_NAME<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¦å¯¼å‡ºä¸€ä¸ªæ–¹æ³•ç»™ JavaScript ä½¿ç”¨ï¼ŒJava æ–¹æ³•éœ€è¦ä½¿ç”¨æ³¨è§£ @ReactMethod</span>
    <span class="token annotation punctuation">@ReactMethod</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fidoInit</span><span class="token punctuation">(</span><span class="token class-name">Promise</span> promise<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">WritableMap</span> map <span class="token operator">=</span> <span class="token class-name">Arguments</span><span class="token punctuation">.</span><span class="token function">createMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ...</span>
            promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>messageString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ReactMethod</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fidoRegister</span><span class="token punctuation">(</span><span class="token class-name">ReadableMap</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å– map ä¸­çš„æ•°æ®</span>
        <span class="token class-name">String</span> userName <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¦‚æœè¦åšä¸€äº›å»¶æ—¶çš„æ“ä½œï¼Œéœ€è¦åœ¨ Android çš„å­çº¿ç¨‹ä¸­å»è°ƒç”¨</span>
        <span class="token comment">// å¦‚æœç”¨ UI çº¿ç¨‹ï¼Œå°±ä¸ç”¨å†™</span>
        <span class="token class-name">UiThreadUtil</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// åŸç”Ÿæ¨¡å—å¯ä»¥åœ¨æ²¡æœ‰è¢«è°ƒç”¨çš„æƒ…å†µä¸‹å¾€ JavaScript å‘é€äº‹ä»¶é€šçŸ¥ã€‚</span>
    <span class="token comment">// æœ€ç®€å•çš„åŠæ³•å°±æ˜¯é€šè¿‡ RCTDeviceEventEmitter ï¼Œè¿™å¯ä»¥é€šè¿‡ ReactContext æ¥è·å¾—å¯¹åº”çš„å¼•ç”¨</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendEvent</span><span class="token punctuation">(</span>
        <span class="token class-name">ReactContext</span> reactContext<span class="token punctuation">,</span>
        <span class="token class-name">String</span> eventName<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">WritableMap</span> params
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        reactContext
                <span class="token punctuation">.</span><span class="token function">getJSModule</span><span class="token punctuation">(</span><span class="token class-name">DeviceEventManagerModule</span><span class="token punctuation">.</span><span class="token class-name">RCTDeviceEventEmitter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å°è£…äº†ä¸€ä¸‹è¿”å›çš„å‚æ•°</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendJSCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> listenName<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> status<span class="token punctuation">,</span> <span class="token class-name">String</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WritableMap</span> params <span class="token operator">=</span> <span class="token class-name">Arguments</span><span class="token punctuation">.</span><span class="token function">createMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">&quot;res&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;ä¼ è¾“çš„æ•°æ®&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ•°æ®&quot;</span><span class="token operator">+</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sendEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reactContext<span class="token punctuation">,</span> listenName<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token keyword">int</span> reqType<span class="token punctuation">,</span> <span class="token class-name">String</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åŸç”Ÿæ¨¡å—ç»™ JS å‘é€äº‹ä»¶</span>
        <span class="token function">sendJSCode</span><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ³¨å†ŒæˆåŠŸ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ......</span>
    <span class="token comment">// è¿™é‡Œåªè´´å‡ºäº†æ¡¥æ¥æ‰€éœ€çš„æ ¸å¿ƒä»£ç ï¼Œå…¶ä»–ä»£ç çœç•¥æ‰äº†</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><p>å¯¹åº”çš„ iOS ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>Foundation<span class="token operator">/</span>Foundation<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>React<span class="token operator">/</span>RCTBridgeModule<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>React<span class="token operator">/</span>RCTEventEmitter<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>


NS_ASSUME_NONNULL_BEGIN

@interface FTFIDOManager <span class="token operator">:</span> RCTEventEmitter <span class="token operator">&lt;</span>RCTBridgeModule<span class="token punctuation">,</span>NSURLSessionDelegate<span class="token punctuation">,</span>NSURLSessionDataDelegate<span class="token punctuation">,</span>NSURLSessionTaskDelegate<span class="token operator">&gt;</span>

@<span class="token function">property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span>strong<span class="token punctuation">)</span>NSMutableData <span class="token operator">*</span>responseData<span class="token punctuation">;</span>

@end

NS_ASSUME_NONNULL_END
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// FIDOModules.m     çœç•¥æ‰ .h æ–‡ä»¶</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">FT_FIDO_INIT fidoInit</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">FT_FIDO_REGISTER fidoRegister</span></span>

<span class="token comment">// å£°æ˜æˆå‘˜å˜é‡ ...</span>
@<span class="token function">property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> NSString <span class="token operator">*</span> username<span class="token punctuation">;</span>

@implementation FTFIDOManager

<span class="token comment">// ä¸ºäº†å®ç° RCTBridgeModule åè®®ï¼Œä½ çš„ç±»éœ€è¦åŒ…å« RCT_EXPORT_MODULE() å®</span>
<span class="token function">RCT_EXPORT_MODULE</span><span class="token punctuation">(</span>FIDOModules<span class="token punctuation">)</span>

<span class="token function">RCT_REMAP_METHOD</span><span class="token punctuation">(</span>FT_FIDO_INIT<span class="token punctuation">,</span>
   resolver<span class="token operator">:</span><span class="token punctuation">(</span>RCTPromiseResolveBlock<span class="token punctuation">)</span>resolve
   rejecter<span class="token operator">:</span><span class="token punctuation">(</span>RCTPromiseRejectBlock<span class="token punctuation">)</span>reject
<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>supportType<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>supportType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    NSError <span class="token operator">*</span>error <span class="token operator">=</span> <span class="token punctuation">[</span>NSError errorWithDomain<span class="token operator">:</span>NSCocoaErrorDomain code<span class="token operator">:</span><span class="token number">1</span> userInfo<span class="token operator">:</span>@<span class="token punctuation">{</span>@<span class="token string">&quot;error&quot;</span><span class="token operator">:</span>@<span class="token string">&quot;è·å–å¤±è´¥&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>@<span class="token string">&quot;no_events&quot;</span><span class="token punctuation">,</span> @<span class="token string">&quot;There were no events&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">RCT_EXPORT_METHOD</span><span class="token punctuation">(</span>FT_FIDO_REGISTER<span class="token operator">:</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span><span class="token punctuation">)</span> json<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// åœ¨ oc ä¸­ï¼Œæ”¶åˆ°çš„æ˜¯ä¸€ä¸ªå­—å…¸</span>
    userName <span class="token operator">=</span> <span class="token punctuation">[</span>json objectForKey<span class="token operator">:</span>@<span class="token string">&quot;userName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">prama</span> <span class="token expression">ç»™ js ç«¯å‘é€äº‹ä»¶</span></span>
<span class="token comment">// è¿™é‡Œéœ€è¦æ³¨å†Œäº‹ä»¶</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSArray<span class="token operator">&lt;</span>NSString <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token punctuation">)</span>supportedEvents
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> @<span class="token punctuation">[</span>@<span class="token string">&quot;register&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// å°è£…äº†ä¸€ä¸‹è¿”å›çš„å‚æ•°</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>sendJSCode<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>listenName
             title<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>title
            status<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>status
               res<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>res
<span class="token punctuation">{</span>
  <span class="token punctuation">[</span>self sendEventWithName<span class="token operator">:</span>listenName body<span class="token operator">:</span>@<span class="token punctuation">{</span>@<span class="token string">&quot;msg&quot;</span><span class="token operator">:</span> title<span class="token punctuation">,</span>@<span class="token string">&quot;status&quot;</span><span class="token operator">:</span> status<span class="token punctuation">,</span>@<span class="token string">&quot;res&quot;</span><span class="token operator">:</span>res<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>onSuccess<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>uafResponse
<span class="token punctuation">{</span>
    <span class="token comment">// åŸç”Ÿæ¨¡å—ç»™ JS å‘é€äº‹ä»¶</span>
    <span class="token punctuation">[</span>self sendJSCode<span class="token operator">:</span>@<span class="token string">&quot;register&quot;</span> title<span class="token operator">:</span>@<span class="token string">&quot;æ³¨å†ŒæˆåŠŸ&quot;</span> status<span class="token operator">:</span>@<span class="token string">&quot;0&quot;</span> res<span class="token operator">:</span>res<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h4 id="äºŒã€æ³¨å†Œæ¨¡å—"><a href="#äºŒã€æ³¨å†Œæ¨¡å—" class="header-anchor">#</a> äºŒã€æ³¨å†Œæ¨¡å—</h4> <p>åœ¨ Android ä¸­éœ€è¦åœ¨åº”ç”¨çš„ Package ç±»çš„<code>createNativeModules</code>æ–¹æ³•ä¸­æ·»åŠ è¿™ä¸ªæ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰è¢«æ³¨å†Œï¼Œåˆ™åœ¨ JavaScript ä¸­æ— æ³•è®¿é—®åˆ°ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * android/app/src/main/java/com/mobile/FIDO/FIDOPackage.java
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>by_mobile<span class="token punctuation">.</span></span>FTFIDO<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span></span><span class="token class-name">ReactPackage</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">NativeModule</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactApplicationContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>uimanager<span class="token punctuation">.</span></span><span class="token class-name">ViewManager</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FIDOPackage</span> <span class="token keyword">implements</span> <span class="token class-name">ReactPackage</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç”¨æ¥åœ¨æ³¨å†Œå¯¼å…¥RNçš„åŸç”Ÿæ¨¡å—</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NativeModule</span><span class="token punctuation">&gt;</span></span> <span class="token function">createNativeModules</span><span class="token punctuation">(</span><span class="token class-name">ReactApplicationContext</span> reactContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NativeModule</span><span class="token punctuation">&gt;</span></span> modules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿™é‡Œæ·»åŠ FIDOModules</span>
        modules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FIDOModules</span><span class="token punctuation">(</span>reactContext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> modules<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ·»åŠ è‡ªå®šä¹‰çš„è§†å›¾ç®¡ç†ç±»</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ViewManager</span><span class="token punctuation">&gt;</span></span> <span class="token function">createViewManagers</span><span class="token punctuation">(</span><span class="token class-name">ReactApplicationContext</span> reactContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>æ¥ä¸‹æ¥éœ€è¦åˆ°<code>MainApplication.java</code>ä¸­æ·»åŠ ï¼Œå› ä¸º APP å¯åŠ¨æ—¶ï¼Œå…ˆæ‰§è¡Œ<code>MainApplication.java</code>ï¼Œç„¶åå†æ‰§è¡Œ<code>MainActivity.java</code>åˆ›å»ºä¸€ä¸ª<code>MainActivity</code>ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * android/app/src/main/java/com/mobile/MainApplication.java
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mobile</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>mobile<span class="token punctuation">.</span></span>FIDO<span class="token punctuation">.</span><span class="token class-name">FIDOPackage</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token keyword">implements</span> <span class="token class-name">ReactApplication</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReactNativeHost</span> mReactNativeHost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReactNativeHost</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ReactPackage</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPackages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;UnnecessaryLocalVariable&quot;</span><span class="token punctuation">)</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ReactPackage</span><span class="token punctuation">&gt;</span></span> packages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PackageList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      packages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FIDOPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> packages<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="ä¸‰ã€javascript-ç«¯å°è£…è°ƒç”¨"><a href="#ä¸‰ã€javascript-ç«¯å°è£…è°ƒç”¨" class="header-anchor">#</a> ä¸‰ã€JavaScript ç«¯å°è£…è°ƒç”¨</h4> <p>ä¸€èˆ¬å°† RN æ¡¥æ¥éƒ¨åˆ†çš„ JavaScript ä»£ç å°è£…èµ·æ¥ï¼Œä½¿ç”¨çš„æ—¶å€™è°ƒç”¨ä¸€ä¸‹å°±è¡Œäº†ã€‚</p> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  NativeModules<span class="token punctuation">,</span>
  NativeEventEmitter<span class="token punctuation">,</span>
  DeviceEventEmitter<span class="token punctuation">,</span>
  Platform<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native'</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token punctuation">{</span>FIDOModules<span class="token punctuation">}</span> <span class="token operator">=</span> NativeModules<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>fidoInit<span class="token punctuation">,</span> fidoRegister<span class="token punctuation">}</span> <span class="token operator">=</span> FIDOModules<span class="token punctuation">;</span>

<span class="token keyword">let</span> EventEmitter <span class="token operator">=</span> Platform<span class="token punctuation">.</span><span class="token constant">OS</span> <span class="token operator">===</span> <span class="token string">'ios'</span>
    <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">NativeEventEmitter</span><span class="token punctuation">(</span>FIDOModules<span class="token punctuation">)</span>
    <span class="token operator">:</span> DeviceEventEmitter<span class="token punctuation">;</span>
<span class="token keyword">let</span> register<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">initFido</span><span class="token punctuation">(</span>fn<span class="token operator">:</span><span class="token builtin">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg<span class="token operator">:</span><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token punctuation">{</span>title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token operator">&gt;=</span> <span class="token keyword">await</span> <span class="token function">fidoInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
    fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">registerFido</span><span class="token punctuation">(</span><span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">await</span> <span class="token function">fidoRegister</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  register <span class="token operator">&amp;&amp;</span> register<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  register<span class="token operator">:</span> EventEmitter <span class="token operator">=</span> EventEmitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="safekey-æ¨¡å—"><a href="#safekey-æ¨¡å—" class="header-anchor">#</a> SafeKey æ¨¡å—</h3> <p>å®‰å…¨é”®ç›˜æ¨¡å—æœ‰ä¸€ä¸ªç‰¹æ®Šçš„éœ€æ±‚ï¼Œè¿™è¾¹ç”±äºé”®ç›˜æ˜¯åœ¨ TEE ç³»ç»Ÿå®ç°çš„ï¼Œç„¶åè¾“å…¥æ¡†éœ€è¦ç”¨ RN è§†å›¾ç»„ä»¶ä¸­çš„ TextInput ã€‚ç°åœ¨éœ€è¦ä½¿ç”¨<code>findNodeHandle</code>å°† RN ä¸­ TextInput ç»„ä»¶çš„ tag å€¼
è·å–åˆ°ï¼Œç„¶åä¼ é€’ç»™ Native é‚£è¾¹ï¼ŒNative æ”¶åˆ°åé€šè¿‡ tag å€¼å†è·å–å¯¹åº”çš„ç»„ä»¶å¯¹è±¡ï¼Œæœ€åå’Œå®‰å…¨é”®ç›˜ç»‘å®šã€‚æ•´ä¸ªå®ç°çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="custom-block tip"><p class="custom-block-title">è·å– uimanager ç±»</p> <p>Android éƒ¨åˆ†çš„ä»£ç ä¸­æ³¨å†Œæ¨¡å—ï¼Œç»™ JS æä¾›è°ƒç”¨æ–¹æ³•ç­‰éƒ½å’Œ FIDO å¤§åŒå°å¼‚ã€‚è¿™é‡Œåªæ˜¯å±•ç¤º tag éœ€è¦çš„æ ¸å¿ƒä»£ç ï¼ï¼ï¼</p> <p>Android è¿™é‡Œéœ€è¦åœ¨<code>com</code>æ–‡ä»¶å¤¹ä¸‹åœ¨åˆ›å»º<code>facebook/react/uimanager/</code>æ–‡ä»¶å¤¹ï¼Œå°†<code>SafeKeyModule.java</code>æ–‡ä»¶å†™åˆ°æ–°åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œæ–¹ä¾¿è·å–åˆ° RN çš„
<code>uimanager</code>ç±»ã€‚</p></div> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * android/app/src/main/java/com/facebook/react/uimanager/SafeKeyModule.java
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>uimanager</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">Arguments</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">Callback</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactApplicationContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactContextBaseJavaModule</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReactMethod</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">ReadableMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">UiThreadUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span></span><span class="token class-name">WritableMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">DeviceEventManagerModule</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>uimanager<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">ViewUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>views<span class="token punctuation">.</span>textinput<span class="token punctuation">.</span></span><span class="token class-name">ReactEditText</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SafeKeyModule</span> <span class="token keyword">extends</span> <span class="token class-name">ReactContextBaseJavaModule</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SET_NAME <span class="token operator">=</span> <span class="token string">&quot;SafeKeyboard&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SafeKeyModule</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nonnull</span> <span class="token class-name">ReactApplicationContext</span> reactContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>reactContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reactContext <span class="token operator">=</span> reactContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> SET_NAME<span class="token punctuation">;</span><span class="token punctuation">}</span>

    <span class="token comment">/**
     * è·å– reactTag  RNç«¯é€šè¿‡ findNodeHandle() è·å–
     * è¿™é‡Œæ˜¯é‡ç‚¹ï¼Œä¹Ÿæ˜¯æ•´ä¸ª Native è°ƒç”¨ RN ç»„ä»¶çš„å…³é”®
     * @param id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">ReactEditText</span> <span class="token function">getEditById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UIViewOperationQueue</span> uii <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getReactApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNativeModule</span><span class="token punctuation">(</span><span class="token class-name">UIManagerModule</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUIImplementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUIViewOperationQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ReactEditText</span><span class="token punctuation">)</span> uii<span class="token punctuation">.</span><span class="token function">getNativeViewHierarchyManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolveView</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ReactMethod</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initSafeKeyboard</span><span class="token punctuation">(</span><span class="token class-name">ReadableMap</span> msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">UiThreadUtil</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿™é‡Œè·å– TextInput ç»„ä»¶çš„ tag</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> reactTag <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;reactTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è¿™é‡Œæ ¹æ® TextInput ç»„ä»¶è·å–å¯¹è±¡</span>
                textInput <span class="token operator">=</span> <span class="token function">getEditById</span><span class="token punctuation">(</span>reactTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>Objective-c å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">&quot;RFTSafeKeyModule.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>React<span class="token operator">/</span>RCTUIManager<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>React<span class="token operator">/</span>RCTBaseTextInputView<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>React<span class="token operator">/</span>RCTBridge<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">RFT_KEYBOARD_INIT initSafeKeyboard</span></span>

@interface <span class="token function">RFTSafeKeyModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token function">property</span> <span class="token punctuation">(</span>strong<span class="token punctuation">,</span>nonatomic<span class="token punctuation">)</span> UITextField <span class="token operator">*</span> textInput<span class="token punctuation">;</span>
@end

@implementation RFTSafeKeyModule
@synthesize bridge <span class="token operator">=</span> _bridge<span class="token punctuation">;</span>

<span class="token function">RCT_EXPORT_MODULE</span><span class="token punctuation">(</span>SafeKeyboard<span class="token punctuation">)</span>

<span class="token function">RCT_EXPORT_METHOD</span><span class="token punctuation">(</span>RFT_KEYBOARD_INIT<span class="token operator">:</span><span class="token punctuation">(</span>nonnull NSDictionary <span class="token operator">*</span><span class="token punctuation">)</span>msg<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// è¿™é‡Œ ui éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨</span>
  <span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    NSNumber <span class="token operator">*</span>reactTag <span class="token operator">=</span> <span class="token punctuation">[</span>msg objectForKey<span class="token operator">:</span>@<span class="token string">&quot;reactTag&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å– input</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>reactTag<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// è·å– TextInput çš„æ ¸å¿ƒä»£ç </span>
      self<span class="token punctuation">.</span>textInput <span class="token operator">=</span> <span class="token punctuation">(</span>UITextField <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>RCTBaseTextInputView<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">[</span>self<span class="token operator">-&gt;</span>_bridge<span class="token punctuation">.</span>uiManager viewForReactTag<span class="token operator">:</span>reactTag<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>backedTextInputView<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// æ”¹å˜è¾“å…¥å…‰æ ‡çš„é¢œè‰²</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">[</span>noChangeNumber integerValue<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        self<span class="token punctuation">.</span>textInput<span class="token punctuation">.</span>tintColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor colorWithWhite<span class="token operator">:</span><span class="token number">1.0</span> alpha<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>JavaScript ä»£ç å®ç°ï¼š</p> <div class="language-typescript jsx line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  NativeModules<span class="token punctuation">,</span>
  TextInput<span class="token punctuation">,</span>
  findNodeHandle<span class="token punctuation">,</span>
  NativeAppEventEmitter<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>SafeKeyboard<span class="token punctuation">}</span> <span class="token operator">=</span> NativeModules<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  initSafeKeyboard
<span class="token punctuation">}</span> <span class="token operator">=</span> SafeKeyboard<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">const</span> SafeInput<span class="token operator">:</span>React<span class="token punctuation">.</span><span class="token constant">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token constant">JSX</span><span class="token punctuation">.</span>element <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> refs <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">!</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">initSafeKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        reactTag<span class="token operator">:</span> <span class="token function">findNodeHandle</span><span class="token punctuation">(</span>refs<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>TextInput
        ref<span class="token operator">=</span><span class="token punctuation">{</span>refs<span class="token punctuation">}</span>
        <span class="token operator">...</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="header-anchor">#</a> ç»“è¯­</h3> <p>å…³äº RN çš„æ¡¥æ¥æˆ‘è¿™é‡Œåªæ˜¯è®²äº†ä¸€å°éƒ¨åˆ†ï¼Œå…¶ä¸­æœ‰äº›ç‰¹æ®Šçš„éœ€æ±‚å’Œçˆ¬è¿‡çš„å‘ä¹Ÿä¸æ­¢è¿™ä¸€ç‚¹ï¼Œæ›´è¦å®è·µçš„æ¢ç´¢å’Œè§£å†³ã€‚æ¯”å¦‚è¿˜æœ‰è°ƒç”¨åŸç”Ÿ UI ç»„ä»¶ç­‰å…¶ä»–ä½¿ç”¨æ–¹æ³•ï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒ RN çš„å®˜ç½‘ï¼Œç†è§£æ‰€æœ‰çš„åŸç†å’Œæµç¨‹ä»¥åï¼Œæ‰èƒ½å†™å‡ºæ›´ä¼˜ç§€çš„ä»£ç ã€‚</p> <h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="header-anchor">#</a> ç›¸å…³é“¾æ¥</h2> <ul><li><a href="https://reactnative.dev/" target="_blank" rel="noopener noreferrer">React Native å®˜ç½‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.freecodecamp.org/news/how-react-native-constructs-app-layouts-and-how-fabric-is-about-to-change-it-dd4cb510d055/" target="_blank" rel="noopener noreferrer">React Native å¦‚ä½•æ„å»ºåº”ç”¨å¸ƒå±€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/henryfordstick/edit/master/docs/blog/react-native-bridge.md" target="_blank" rel="noopener noreferrer">æœ¬æ–‡æºç åœ°å€</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">æ›´æ–°æ—¶é—´:</span> <span class="time">11/8/2020, 12:01:14 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/react-native.html" class="prev">
        React Native ä½¿ç”¨æ€»ç»“
      </a></span> <span class="next"><a href="/blog/js-undefined-null.html">
        null å’Œ undefined åŒºåˆ«
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.596f9c08.js" defer></script><script src="/assets/js/2.55845630.js" defer></script><script src="/assets/js/32.3cfb5af5.js" defer></script><script src="/assets/js/3.e0f79c9f.js" defer></script>
  </body>
</html>
